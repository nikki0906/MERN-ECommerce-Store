{
    "sourceFile": "frontend/src/pages/PlaceOrder.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1747654188423,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1747654685504,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,8 +42,37 @@\n       console.error('Failed to place order:', error);\r\n     }\r\n   };\r\n \r\n+  const handlePayment = async () => {\r\n+  try {\r\n+    const { data } = await axios.post(\r\n+      'http://localhost:5000/api/payments/order',\r\n+      { amount: totalPrice },\r\n+      {\r\n+        headers: {\r\n+          Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n+        },\r\n+      }\r\n+    );\r\n+\r\n+    const options = {\r\n+      key: process.env.REACT_APP_RAZORPAY_KEY,\r\n+      amount: data.amount,\r\n+      currency: data.currency,\r\n+      order_id: data.id,\r\n+      handler: function (response) {\r\n+        alert(`Payment successful! ID: ${response.razorpay_payment_id}`);\r\n+      },\r\n+    };\r\n+\r\n+    const rzp1 = new window.Razorpay(options);\r\n+    rzp1.open();\r\n+  } catch (error) {\r\n+    console.error('Payment Failed:', error);\r\n+  }\r\n+};\r\n+\r\n   return (\r\n     <div>\r\n       <h2>Place Order</h2>\r\n \r\n"
                },
                {
                    "date": 1747654720962,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,8 +42,10 @@\n       console.error('Failed to place order:', error);\r\n     }\r\n   };\r\n \r\n+  <button onClick={handlePayment}>Pay Now</button>\r\n+\r\n   const handlePayment = async () => {\r\n   try {\r\n     const { data } = await axios.post(\r\n       'http://localhost:5000/api/payments/order',\r\n"
                },
                {
                    "date": 1747654780930,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,96 @@\n+import React, { useState } from 'react';\r\n+import axios from 'axios';\r\n+import { useNavigate } from 'react-router-dom';\r\n+\r\n+const PlaceOrder = () => {\r\n+  const [shippingAddress, setShippingAddress] = useState({\r\n+    address: '',\r\n+    city: '',\r\n+    postalCode: '',\r\n+    country: ''\r\n+  });\r\n+  const [paymentMethod, setPaymentMethod] = useState('Credit Card');\r\n+  const navigate = useNavigate();\r\n+\r\n+  const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];\r\n+  const totalPrice = cartItems.reduce((acc, item) => acc + item.price * item.qty, 0);\r\n+\r\n+  const placeOrderHandler = async () => {\r\n+    try {\r\n+      const token = localStorage.getItem('token');\r\n+      const config = {\r\n+        headers: {\r\n+          Authorization: `Bearer ${token}`,\r\n+        },\r\n+      };\r\n+\r\n+      const { data } = await axios.post(\r\n+        'http://localhost:5000/api/orders',\r\n+        {\r\n+          orderItems: cartItems,\r\n+          shippingAddress,\r\n+          paymentMethod,\r\n+          totalPrice,\r\n+        },\r\n+        config\r\n+      );\r\n+\r\n+      console.log('Order placed successfully:', data);\r\n+      navigate(`/orders`);\r\n+    } catch (error) {\r\n+      console.error('Failed to place order:', error);\r\n+    }\r\n+  };\r\n+\r\n+  // ðŸ‘‰ Payment Handler\r\n+  const handlePayment = async () => {\r\n+    try {\r\n+      const { data } = await axios.post(\r\n+        'http://localhost:5000/api/payments/order',\r\n+        { amount: totalPrice },\r\n+        {\r\n+          headers: {\r\n+            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n+          },\r\n+        }\r\n+      );\r\n+\r\n+      const options = {\r\n+        key: process.env.REACT_APP_RAZORPAY_KEY,\r\n+        amount: data.amount,\r\n+        currency: data.currency,\r\n+        order_id: data.id,\r\n+        handler: async function (response) {\r\n+          alert(`Payment successful! ID: ${response.razorpay_payment_id}`);\r\n+\r\n+          // âœ… Call API to mark the order as paid\r\n+          await axios.put(\r\n+            `http://localhost:5000/api/orders/${data.id}/pay`,\r\n+            { paymentResult: response },\r\n+            {\r\n+              headers: {\r\n+                Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n+              },\r\n+            }\r\n+          );\r\n+          navigate('/orders');\r\n+        },\r\n+      };\r\n+\r\n+      const rzp1 = new window.Razorpay(options);\r\n+      rzp1.open();\r\n+    } catch (error) {\r\n+      console.error('Payment Failed:', error);\r\n+    }\r\n+  };\r\n+\r\n+  return (\r\n+    <div>\r\n+      <h2>Place Order</h2>\r\n+      <button onClick={placeOrderHandler}>Place Order</button>\r\n+      <button onClick={handlePayment} style={{ marginLeft: '10px' }}>Pay Now</button>\r\n+    </div>\r\n+  );\r\n+};\r\n+\r\n+export default PlaceOrder;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1747654801959,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,91 +92,5 @@\n     </div>\r\n   );\r\n };\r\n \r\n-export default PlaceOrder;\n-import React, { useState } from 'react';\r\n-import axios from 'axios';\r\n-import { useNavigate } from 'react-router-dom';\r\n-\r\n-const PlaceOrder = () => {\r\n-  const [shippingAddress, setShippingAddress] = useState({\r\n-    address: '',\r\n-    city: '',\r\n-    postalCode: '',\r\n-    country: ''\r\n-  });\r\n-  const [paymentMethod, setPaymentMethod] = useState('Credit Card');\r\n-  const navigate = useNavigate();\r\n-\r\n-  const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];\r\n-\r\n-  const totalPrice = cartItems.reduce((acc, item) => acc + item.price * item.qty, 0);\r\n-\r\n-  const placeOrderHandler = async () => {\r\n-    try {\r\n-      const token = localStorage.getItem('token');\r\n-      const config = {\r\n-        headers: {\r\n-          Authorization: `Bearer ${token}`,\r\n-        },\r\n-      };\r\n-\r\n-      const { data } = await axios.post(\r\n-        'http://localhost:5000/api/orders',\r\n-        {\r\n-          orderItems: cartItems,\r\n-          shippingAddress,\r\n-          paymentMethod,\r\n-          totalPrice,\r\n-        },\r\n-        config\r\n-      );\r\n-\r\n-      console.log('Order placed successfully:', data);\r\n-      navigate('/orders'); // Redirect to My Orders\r\n-    } catch (error) {\r\n-      console.error('Failed to place order:', error);\r\n-    }\r\n-  };\r\n-\r\n-  <button onClick={handlePayment}>Pay Now</button>\r\n-\r\n-  const handlePayment = async () => {\r\n-  try {\r\n-    const { data } = await axios.post(\r\n-      'http://localhost:5000/api/payments/order',\r\n-      { amount: totalPrice },\r\n-      {\r\n-        headers: {\r\n-          Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n-        },\r\n-      }\r\n-    );\r\n-\r\n-    const options = {\r\n-      key: process.env.REACT_APP_RAZORPAY_KEY,\r\n-      amount: data.amount,\r\n-      currency: data.currency,\r\n-      order_id: data.id,\r\n-      handler: function (response) {\r\n-        alert(`Payment successful! ID: ${response.razorpay_payment_id}`);\r\n-      },\r\n-    };\r\n-\r\n-    const rzp1 = new window.Razorpay(options);\r\n-    rzp1.open();\r\n-  } catch (error) {\r\n-    console.error('Payment Failed:', error);\r\n-  }\r\n-};\r\n-\r\n-  return (\r\n-    <div>\r\n-      <h2>Place Order</h2>\r\n-\r\n-      <button onClick={placeOrderHandler}>Place Order</button>\r\n-    </div>\r\n-  );\r\n-};\r\n-\r\n export default PlaceOrder;\n\\ No newline at end of file\n"
                }
            ],
            "date": 1747654188423,
            "name": "Commit-0",
            "content": "import React, { useState } from 'react';\r\nimport axios from 'axios';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst PlaceOrder = () => {\r\n  const [shippingAddress, setShippingAddress] = useState({\r\n    address: '',\r\n    city: '',\r\n    postalCode: '',\r\n    country: ''\r\n  });\r\n  const [paymentMethod, setPaymentMethod] = useState('Credit Card');\r\n  const navigate = useNavigate();\r\n\r\n  const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];\r\n\r\n  const totalPrice = cartItems.reduce((acc, item) => acc + item.price * item.qty, 0);\r\n\r\n  const placeOrderHandler = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const config = {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      };\r\n\r\n      const { data } = await axios.post(\r\n        'http://localhost:5000/api/orders',\r\n        {\r\n          orderItems: cartItems,\r\n          shippingAddress,\r\n          paymentMethod,\r\n          totalPrice,\r\n        },\r\n        config\r\n      );\r\n\r\n      console.log('Order placed successfully:', data);\r\n      navigate('/orders'); // Redirect to My Orders\r\n    } catch (error) {\r\n      console.error('Failed to place order:', error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h2>Place Order</h2>\r\n\r\n      <button onClick={placeOrderHandler}>Place Order</button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PlaceOrder;"
        }
    ]
}